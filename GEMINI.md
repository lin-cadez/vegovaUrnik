# vegovaUrnik - Digitalized School Timetable

This project digitalizes school timetables using ESP32-based "Cheap Yellow Displays" (CYD). It displays real-time schedule information, including current lessons, teachers, and classrooms, by fetching data from a web API.

## Project Overview

*   **Target Hardware:** ESP32 Smart Display (Sunton/CYD models).
*   **Main Technologies:**
    *   **C++/Arduino:** Core logic and hardware interaction.
    *   **LVGL:** Graphics library for the user interface.
    *   **SquareLine Studio:** UI design tool (project files included in root).
    *   **PlatformIO:** Build system and dependency management.
    *   **ArduinoJson:** For parsing timetable data from the API.

## Architecture

The application follows a dual-core architecture on the ESP32:
*   **Core 0 (LVGL_Task):** Dedicated to UI rendering and user interaction via LVGL. It periodically refreshes the display and synchronizes the UI state from the application state.
*   **Core 1 (Other_Logic):** Handles network connectivity (WiFi), NTP time synchronization, and fetching/parsing timetable data from the `https://urnik.kralj.io` API.
*   **State Management:** A shared `AppState` structure, protected by a `dataMutex` (FreeRTOS Semaphore), facilitates communication between the two cores.

## Building and Running

The project uses PlatformIO. Commands should be run from the `source code/esp32-smartdisplay-demo-main/` directory.

### Build the Project
```bash
pio run
```

### Upload to ESP32
```bash
pio run -t upload
```

### Serial Monitor
```bash
pio run -t monitor
```

### Environment Selection
The project supports multiple display models. You can specify the environment in `platformio.ini` or via the `-e` flag:
```bash
pio run -e esp32-2432S028R  # Example for the common 2.8" CYD
```

## Project Structure

*   `source code/esp32-smartdisplay-demo-main/`: Main PlatformIO project.
    *   `src/main.cpp`: Main application logic and task management.
    *   `src/ui/`: UI code generated by SquareLine Studio.
    *   `platformio.ini`: Project configuration and dependencies.
*   `SquareLine_Project.spj`: The source project for SquareLine Studio.
*   `assets/`: UI assets (fonts, images) used by SquareLine Studio and exported to the code.
*   `components/`: Reusable UI components for SquareLine Studio.
*   `sequence_original/`: Original design assets or reference frames.

## Development Conventions

*   **UI Updates:** Modifying the UI should ideally be done in SquareLine Studio and then re-exported to `src/ui/`.
*   **Thread Safety:** Always use `dataMutex` when accessing `appState` to prevent race conditions between the UI and logic tasks.
*   **Configuration:** WiFi credentials and classroom number are currently hardcoded in `main.cpp`.
